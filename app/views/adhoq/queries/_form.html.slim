= form_for query, html: {class: 'form query-form', role: 'form'} do |f|
  .page-header
    h1
      = f.label :query, title, class: 'control-label'
      .pull-right
        a.btn.btn-default.btn-sm[href='#' data-trigger='toggleCurrentTables' role='show']
          i.fa.fa-database.fa-pad-r
          | Show tables

  .form-group
    = f.text_area :query, class: 'form-control', rows: 10, required: true

  .modal.fade#nameAndDesc[role='dialog']
    .modal-dialog
      .modal-content
        .modal-header
          button.close[data-dismiss='modal' aria-label='Close']
          h4 Add name and description
        .modal-body
          .form-horizontal
            .form-group
              = f.label :name, class: 'control-label col-sm-2'
              .col-sm-8
                = f.text_field :name, class: 'form-control', required: true

            .form-group
              = f.label :description, class: 'control-label col-sm-2'
              .col-sm-8
                = f.text_area :description, class: 'form-control', required: true
        .modal-footer
          button.btn.btn-primary
            i.fa.fa-floppy-o.fa-pad-r
            | Save

.actions
  button.btn.btn-default
    i.fa.fa-refresh.fa-pad-r
    | Reflesh

  button.btn.btn-primary[data-toggle='modal' data-target='#nameAndDesc']
    i.fa.fa-floppy-o.fa-pad-r
    | Save as...

  - if query.persisted?
    = link_to 'Cancel', f.object, class: 'btn btn-default'

ul.nav.nav-tabs[role='tablist']
  li.active
    a[role='tab' data-toggle='tab' href='#preview' ]
      i.fa.fa-eye.fa-pad-r
      | Preview
  li
    a[role='tab' data-toggle='tab' href='#explain' ]
      i.fa.fa-info.fa-pad-r
      | Explain

.tab-content
  #preview.tab-pane.active
    h3
      | Query preview
      small
        = link_to preview_path, class: 'js-preview-button', data: {source: '#query_query', result: '.js-preview-result', remote: true, method: 'POST'} do
          i.fa.fa-refresh.fa-pad-r[data-title='Refresh preview']
          | Reflesh

    .js-preview-result
      .alert.alert-info Preview is shown here

  #explain.tab-pane
    h3
      | Query explain
      small
        = link_to explain_path, class: 'js-explain-button', data: {source: '#query_query', result: '.js-explain-result', remote: true, method: 'POST'} do
          i.fa.fa-refresh.fa-pad-r[data-title='Refresh explain']
          | Reflesh

    .js-explain-result
      .alert.alert-info Explain result is shown here

javascript:
  $(function() {
    Adhoq.enablePreview($('#preview a.js-preview-button'));
    Adhoq.enablePreview($('#explain a.js-explain-button'));
  });

